# 1장. 사용자 수에 따른 규모 확장성

## TL;DR

1.

<hr>
<br>

## Goal

1. 1명부터 수백만 사용자를 지원하는 시스템을 설계한다.
2. 규모 확장성과 관계된 설계 문제를 푸는 데 쓰일 유용한 지식을 습득한다.

<hr>
<br>

## 단일 서버

- 서버 1대에서 웹, 앱, 데이터베이스, 캐시 등을 전부 실행한다.
  > 이미지

### 사용자 요청 처리 흐름

1. 사용자는 도메인 이름(www.google.com)을 이용하여 웹사이트에 접속한다.

   - 이 접속을 위해 도메인 이름을 도메인 이름 서비스(DNS: Domain Name Service)에 물어봐서(질의하여) IP 주소로 변환하는 과정이 필요하다.

   - DNS는 보통 제3 사업자(third party)가 제공하는 유료 서비스(외부 서비스)를 이용하게 되므로 우리 시스템의 일부는 아니다.

2. DNS 조회 결과로 IP 주소가 반환된다.

   - 구글의 경우, IP 주소는 66.249.73.236로 웹 주소이다.

3. 해당 IP 주소로 HTTP(HyperText Transfer Protocol) 요청이 전달된다.

4. 요청을 받은 웹 서버는 HTML 페이지나 JSON 형태의 응답을 반환한다.

### 실제 요청은 두 가지 종류의 단말로부터 온다.

1. 웹 애플리케이션

   - 비즈니스 로직, 데이터 저장 등을 처리하기 위해서 서버 구현용 언어(Java, Python 등)를 사용한다.

   - 프레젠테이션용으로는 클라이언트 구현용 언어(HTML, JavaScript 등)을 사용한다.

2. 모바일 앱

   - 모바일 앱 - 웹 서버 간 통신을 위해 HTTP 프로토콜을 이용한다.

   - HTTP 프로토콜을 통해서 반환될 응답 데이터의 포맷으로는 보통 간결함이 장점인 JSON(JavaScript Object Notation)을 사용한다.

     ```json
     // GET /users/42 : id가 42인 사용자 데이터에 접근

     {
       "id": 42,
       "name": "yeslee",
       "address": {
         "city": "Yongin",
         "country": "South Korea"
       },
       "phoneNumber": 01012345678
     }
     ```

<hr>
<br>

## 데이터베이스

- 사용자가 늘어나면 서버 하나로는 충분하지 않기 때문에 여러 대의 서버를 두어야 한다.

  - 웹/모바일 트래픽 처리 서버: 웹 계층
  - 데이터베이스 서버: 데이터 계층

### 어떤 데이터베이스를 사용할 것인가?

- 관계형 데이터베이스, 관계형 데이터베이스 관리 시스템(RDBMS: Relational Data-base Management System)

  - MySQL, Oracle, PostgreSQL: table, row, column으로 자료를 표현한다.

  - SQL(Structured Query Language)을 사용하면 여러 테이블에 있는 데이터를 그 관계(relation)에 따라 합칠 수 있다(join).

- 비-관계형 데이터베이스(No SQL)

  - CouchDB, Neo4j, Cassandra, HBase, Amazon DynamoDB

  - 키-값 저장소(key-value store), 그래프 저장소(graph store), 칼럼 저장소(column store), 문서 저장소(document store) 4 부류로 나눠진다.

  - join 연산은 지원하지 않는다.

- RDB를 주로 사용하지만 다음과 같은 경우에는 No-SQL을 사용하는 것이 바람직하다.

  - 아주 낮은 응답 지연시간(latency)가 요구될 때

  - 비정형(unstructured) 데이터를 다룰 때: 동영상 파일, 오디오 파일, 사진, 문서, 메일 본문 등

  - 데이터(JSON, YAML, XML 등)를 직렬화(serialize) 혹은 역직렬화(deserialize)하기만 하면 될 때

  - 아주 많은 양의 데이터를 저장해야할 때

<hr>
<br>

## 수직적 규모 확장 vs 수평적 규모 확장

- 수직적 규모 확장(vertical scailing) 프로세스

  - 스케일 업(scale up), 서버에 고사양 자원을 추가한다.

  - 서버로 유입되는 트래픽의 양이 적을 때 사용하며 단순하다.

  - 한 대의 서버에 CPU나 메모리를 무한대로 증설하는데 한계가 있다.

  - 서버에 장애가 발생하면 웹사이트/앱은 완전히 중단되어 장애에 대한 자동복구(failover)나 다중화(redundancy) 방안을 제시하지 않는다.

- 수평적 규모 확장(horizonal scailing) 프로세스: 스케일 아웃(scale out), 더 많은 서버를 추가한다.

  - 대규모 애플리케이션을 지원하는데 적절하다.

  - 사용자는 웹 서버로 바로 연결되는데, 웹 서버가 다운되거나 너무 많은 사용자가 접속하여 웹 서버가 한계 상황에 도달하게 되면 응답 속도가 느려지거나 서버 접속이 불가능할 수 있다. -> 부하 분산기 또는 로드밸런서(load balancer)를 도입하는 이유

### 로드밸런서

- 부하 분산 집합(load balancing set)에 속한 웹 서버들에게 트래픽 부하를 고르게 분산한다.
  > 이미지
- 사용자가 로드밸런서의 공개 IP 주소(public IP address)로 접속할 때 웹 서버는 클라이언트의 접속을 직접 처리하지 않는다.

- 더 나은 보안을 위해, 서버간 통신에는 사설 IP 주소(private IP address)를 사용한다.

  > 사설 IP 주소
  >
  > - 같은 네트워크에 속한 서버 사이의 통신에만 쓰이는 IP 주소
  >
  > - 인터넷을 통해 접속할 수 없다.
  >
  > - 로드밸런서가 웹 서버와 통신할 때 사설 IP 주소를 이용한다.

- 부하 분산 집합에 또 하나의 웹 서버 추가 -> failover(장애를 자동복구하지 못하는 문제) 해소, 웹 계층 가용성(availability) 향상

  -
